<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover" />
  <title>Le Village Ronsard — Jeu Chrono (Mobile)</title>
  <meta name="description" content="Jeu de précision chronométré — Le Village Ronsard, Paris" />
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@500;700&family=Inter:wght@400;500;700&display=swap" rel="stylesheet">
  <style>
    :root{
      --green:#0f3d2e; --green-2:#155643; --gold:#b8902e; --cream:#f7f2e9; --ink:#1d1d1b; --error:#9e1c1c;
      --shadow: 0 10px 30px rgba(0,0,0,.15);
      --radius: 18px; --radius-lg: 24px;
      --tap: 14px;
    }
    html,body{height:100%}
    body{
      margin:0; background:
        radial-gradient(80% 60% at 100% -10%, rgba(255,255,255,.25), transparent 60%),
        radial-gradient(75% 60% at 0% 110%, rgba(255,255,255,.25), transparent 60%),
        linear-gradient(160deg, #103228 0%, #0c2a21 100%);
      color:var(--cream);
      font-family: Inter, system-ui, -apple-system, Segoe UI, Roboto, Arial, sans-serif;
      min-height:100vh; display:flex; align-items:flex-start; justify-content:center;
      padding: env(safe-area-inset-top) env(safe-area-inset-right) calc(12px + env(safe-area-inset-bottom)) env(safe-area-inset-left);
    }

    .topbar{position:fixed;top:0;left:0;right:0;z-index:20;background:var(--green);box-shadow:0 8px 24px rgba(0,0,0,.35)}
    .topbar-inner{display:flex;gap:10px;align-items:center;justify-content:center;padding:10px 12px}
    .brandmark{width:64px;height:64px;border:2px solid var(--gold);border-radius:50%;display:grid;place-items:center;font-family:"Playfair Display", serif;color:var(--gold);font-weight:700;background:rgba(0,0,0,.06)}
    .topbar h1{font-family:"Playfair Display", serif;color:var(--cream);font-size:clamp(18px,5vw,28px);margin:0}

    .message{ max-width:720px; background:var(--cream); color:var(--ink); border-radius:var(--radius-lg); box-shadow:var(--shadow); padding:22px; text-align:center; margin:100px 16px 16px; }
    h2{ margin:.2rem 0;color:var(--green);font-family:'Playfair Display',serif; font-size:clamp(18px,4.5vw,26px) }
    .btn{ display:inline-flex; align-items:center; justify-content:center; gap:10px; margin-top:14px; padding:16px 22px; font-weight:800; text-decoration:none; border-radius:999px; background:var(--green); color:var(--cream); box-shadow:0 10px 28px rgba(15,61,46,.38); transition:transform .06s ease, box-shadow .2s; min-width: min(320px, 90vw); -webkit-tap-highlight-color: transparent; border:0 }
    .btn:active{ transform: translateY(1px); box-shadow:0 8px 20px rgba(15,61,46,.45) }
    .btn-ghost{background:transparent;border:2px solid var(--green);color:var(--green)}
    .btn-gold{background:var(--gold); color:#241d0f}
    .hint{ font-size:13px; opacity:.85; margin-top:10px }
    .warn{ color:var(--error); font-weight:700 }

    .wrap{max-width:980px;margin:0 auto;padding:100px 20px 20px;display:none;width:100%}

    .card{background:var(--cream);color:var(--ink);border-radius:var(--radius);box-shadow:var(--shadow);overflow:hidden}
    .card .head{background:linear-gradient(180deg, var(--green) 0%, var(--green-2) 100%); color:var(--cream); padding:16px 18px;display:flex;align-items:center;justify-content:space-between;gap:8px;flex-wrap:wrap}
    .badge{border:1px solid rgba(255,255,255,.45);padding:8px 12px;border-radius:999px;font-size:12px}
    .body{padding:16px}

    .game{margin-top:0}
    .timer{font-family:"Playfair Display", serif;font-size:clamp(64px,15vw,128px);text-align:center;margin:8px 0;color:var(--green);transition: transform .25s ease, color .25s ease, text-shadow .25s ease}
    .controls{position:sticky;bottom:0;display:flex;justify-content:center;flex-direction:column;align-items:center;gap:10px;flex-wrap:wrap;padding:8px 0 0}
    .controls .btn{flex:1 1 220px;min-height:56px;padding-block:18px}

    .panel{display:grid;gap:14px;grid-template-columns:1fr;max-width:760px;margin:0 auto}
    .rules{font-size:15px;line-height:1.6;background:#fff;border:1px dashed #d7c9a4;border-radius:14px;padding:14px}

    .stage{position:relative;background:linear-gradient(180deg,#fff, #fbf7ef);border-radius:18px;border:1px solid #e8e1cf;min-height:240px;display:grid;place-items:center;overflow:hidden}
    .curtain{
      position:absolute;inset:0;
      background: var(--green);
      display:grid;place-items:center;
      transform:translateY(-100%);transition:transform .5s ease;
    }
    @media (prefers-reduced-motion: reduce){ .curtain{ transition:none } }
    .curtain.show{transform:translateY(0)}
    .curtain::after{
      content: "Appuie sur STOP quand tu penses que c'est bon !";
      color: #d9d1bd;
      font-family: "Playfair Display", serif;
      font-size: clamp(16px, 4vw, 20px);
      letter-spacing: .4px;
      text-align: center;
      padding: 0 16px;
    }

    .result{display:none;margin-top:8px; padding:12px 14px; border-radius:12px; background:#f3efe6; border:1px solid #e0d6bd}
    .result .value{font-weight:800}

    #fx{position:absolute;inset:0;pointer-events:none}
    .overlay{position:absolute;inset:0;display:grid;place-items:center;pointer-events:none}
    .stamp{display:inline-grid;place-items:center;gap:8px;padding:16px 22px;border-radius:999px;font-weight:900;letter-spacing:.06em;filter:drop-shadow(0 6px 18px rgba(0,0,0,.18));opacity:0;transform:scale(.8)}
    .stamp.win{background:rgba(21,86,67,.08);border:3px solid #1e8a6b;color:#0f573f}
    .stamp.fail{background:rgba(158,28,28,.08);border:3px solid #c43a3a;color:#8e1717}

    @keyframes popIn { from { opacity:0; transform:scale(.8) rotate(-4deg)} 50%{opacity:1; transform:scale(1.06) rotate(2deg)} to { opacity:1; transform:scale(1) rotate(0)} }
    @keyframes shake { 0%,100%{ transform:translateX(0)} 20%{transform:translateX(-6px)} 40%{transform:translateX(6px)} 60%{transform:translateX(-4px)} 80%{transform:translateX(4px)} }
    @keyframes flashRed { from { box-shadow:inset 0 0 0 0 rgba(196,58,58,.0)} 50%{ box-shadow:inset 0 0 0 8px rgba(196,58,58,.18)} to { box-shadow:inset 0 0 0 0 rgba(196,58,58,.0)} }
    @keyframes glowRing { from { box-shadow:0 0 0 0 rgba(30,138,107,.0), 0 0 0 0 rgba(30,138,107,.0) } 50%{ box-shadow:0 0 0 14px rgba(30,138,107,.12), 0 0 0 28px rgba(30,138,107,.06)} to { box-shadow:0 0 0 0 rgba(30,138,107,.0), 0 0 0 0 rgba(30,138,107,.0) } }

    .stage.win{animation: glowRing 1000ms ease-out 1}
    .stage.fail{animation: flashRed 500ms ease-out 1}
    .timer.win{color:#0f573f; text-shadow:0 6px 24px rgba(15,87,63,.22)}
    .timer.fail{color:#8e1717; text-shadow:0 6px 24px rgba(142,23,23,.25)}
    .shake{animation: shake 420ms ease-out 1}

    .backdrop{position:fixed;inset:0;background:rgba(0,0,0,.45);display:none;align-items:center;justify-content:center;padding:16px}
    .modal{width:min(680px,100%);background:#fff;border-radius:20px;box-shadow:var(--shadow);overflow:hidden}
    .modal, .modal *{ color:#111 !important }

    .ticket{position:relative;padding:18px}
    .ticket:before,.ticket:after{content:"";position:absolute;top:0;bottom:0;width:22px;background:repeating-linear-gradient(180deg, #f7f2e9 0 12px, #efe7d6 12px 24px)}
    .ticket:before{left:-12px;border-right:1px dashed #d4c6a3;border-top-left-radius:16px;border-bottom-left-radius:16px}
    .ticket:after{right:-12px;border-left:1px dashed #d4c6a3;border-top-right-radius:16px;border-bottom-right-radius:16px}
    .certhead{display:flex;align-items:center;justify-content:space-between;gap:12px;flex-wrap:wrap}
    .certhead h3{margin:0;font-family:"Playfair Display",serif;font-size:24px;color:var(--green)}
    .certbody{margin-top:10px;display:grid;gap:8px}
    .row{display:flex;align-items:center;justify-content:space-between;border-bottom:1px dashed #e7dcc2;padding:8px 0;gap:6px}
    .row b{color:#2a2a26}
    .certfoot{display:flex;align-items:center;justify-content:space-between;margin-top:14px;gap:12px;flex-wrap:wrap}
    .mark{display:inline-block;border:2px solid var(--green);color:var(--green);padding:6px 10px;border-radius:8px;font-weight:700}
    .print-hint{font-size:12px;opacity:.75;margin-top:6px}

    .sr-only{position:absolute;width:1px;height:1px;padding:0;margin:-1px;overflow:hidden;clip:rect(0,0,0,0);white-space:nowrap;border:0}

    @media (max-width:480px){ .row{flex-direction:column;align-items:flex-start} }
    @media print{ body{background:#fff} #gate, .backdrop{display:none} }
  </style>
</head>
<body>
  <div class="topbar" role="banner">
    <div class="topbar-inner">
      <div class="brandmark" aria-hidden="true">VR</div>
      <h1>Le Village Ronsard — Jeu Chrono</h1>
    </div>
  </div>

  <section id="gate" class="message" aria-live="polite" aria-atomic="true">
    <h2>Déverrouillez le jeu</h2>
    <p>Pour accéder au jeu, cliquez ci-dessous et laissez un avis sur Google Maps.</p>
    <a class="btn" id="openMaps" target="_blank" rel="noopener"
       href="https://www.google.fr/maps/place/Le+Village+Ronsard/@48.8502034,2.3480831,19z/data=!4m11!1m2!2m1!1smaubert+mutualit%C3%A9!3m7!1s0x47e671e6be62f4e1:0x6c4ad3222a595bd!8m2!3d48.8498161!4d2.3481585!9m1!1b1!16s%2Fg%2F1tkbxjsm!5m1!1e1?entry=ttu&g_ep=EgoyMDI1MDkxMC4wIKXMDSoASAFQAw%3D%3D">Laisser un avis Google</a>
    <div class="hint">Le jeu se déverrouillera automatiquement après l'ouverture de la page d’avis.</div>
    <div id="triesInfo" class="hint" aria-live="polite"></div>
    <div id="playedBanner" class="hint" style="display:none"><span class="warn">Nombre d'essais épuisés sur cet appareil.</span></div>
  </section>

  <div class="wrap" id="app" hidden>
    <section class="card game" id="game" aria-describedby="rules">
      <div class="head">
        <div>
          <strong>Jeu Chrono</strong>
          <div class="badge">Objectif : arrêter à <b>0,00 s</b> (tolérance 0,10 s)</div>
        </div>
        <div style="display:flex;gap:8px;align-items:center;flex-wrap:wrap">
          <div class="badge">Récompense : dessert 🍰 ou boisson 🥤</div>
          <div class="badge" id="badgeTries">Essai 1/3</div>
        </div>
      </div>
      <div class="body">
        <div class="panel">
          <div class="stage" aria-live="polite" aria-atomic="true">
            <canvas id="fx"></canvas>
            <div class="overlay" aria-hidden="true">
              <div id="stampWin" class="stamp win" role="img" aria-label="Gagné" hidden>
                <svg width="34" height="34" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M20 6L9 17l-5-5" stroke="currentColor" stroke-width="3" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
                <span>GAGNÉ</span>
              </div>
              <div id="stampFail" class="stamp fail" role="img" aria-label="Perdu" hidden>
                <svg width="34" height="34" viewBox="0 0 24 24" fill="none" aria-hidden="true">
                  <path d="M6 6l12 12M18 6L6 18" stroke="currentColor" stroke-width="3" stroke-linecap="round"/>
                </svg>
                <span>PERDU</span>
              </div>
            </div>
            <div class="timer" id="timer" aria-label="Temps restant">10,00</div>
            <div class="curtain" id="curtain" aria-hidden="true"></div>
          </div>

          <div class="controls" role="group" aria-label="Contrôles">
            <button class="btn" id="startBtn" aria-describedby="startHint">Démarrer</button>
            <button class="btn btn-gold" id="stopBtn" disabled>STOP</button>
            <button class="btn btn-ghost" id="replayBtn" disabled>Rejouer</button>
          </div>
          <span id="startHint" class="sr-only">Trois essais maximum par appareil. Utilisez STOP pour arrêter le chrono.</span>

          <div class="rules" id="rules">
            <b>Règles :</b>
            <ul>
              <li>Un décompte démarre à <b>10,00 s</b>.</li>
              <li>À <b>5 s</b> restantes, un rideau masque le temps.</li>
              <li>Appuyez sur <b>STOP</b> au moment que vous jugez le plus proche de zéro.</li>
              <li>Si l’affichage est entre <b>-0,10 s</b> et <b>+0,10 s</b> inclus, vous gagnez.</li>
              <li class="warn"><b>Important :</b> <u>3 essais maximum par appareil</u>. Le compteur d'essais est indiqué au-dessus.</li>
            </ul>
          </div>

          <div class="result" id="result"></div>
        </div>
      </div>
    </section>
  </div>

  <!-- scripts identiques à l'original, seule la logique pour le bouton rejouer est ajoutée -->
  <script>
    // ... tout identique sauf la partie où on ajoute la logique pour rejouer
    (function(){
      const timerEl = document.querySelector('#timer');
      const startBtn = document.querySelector('#startBtn');
      const stopBtn = document.querySelector('#stopBtn');
      const replayBtn = document.querySelector('#replayBtn');
      let startAt = null;
      let raf = null;
      let stopped = false;

      function fmt(t){ const sign = t<0?'-':''; return sign+Math.abs(t).toFixed(2).replace('.',','); }
      function render(now){ if(startAt==null) return; const elapsed=(now-startAt)/1000; timerEl.textContent=fmt(10-elapsed); if(!stopped){raf=requestAnimationFrame(render);} }
      function start(){ stopped=false; startAt=performance.now(); timerEl.textContent='10,00'; startBtn.disabled=true; stopBtn.disabled=false; replayBtn.disabled=true; raf&&cancelAnimationFrame(raf); raf=requestAnimationFrame(render); }
      function stop(){ if(startAt==null||stopped)return; stopped=true; stopBtn.disabled=true; replayBtn.disabled=false; raf&&cancelAnimationFrame(raf); const now=performance.now(); timerEl.textContent=fmt(10-(now-startAt)/1000); }
      function replay(){ timerEl.textContent='10,00'; startBtn.disabled=false; stopBtn.disabled=true; replayBtn.disabled=true; stopped=true; raf&&cancelAnimationFrame(raf); }

      startBtn.addEventListener('click',start);
      stopBtn.addEventListener('click',stop);
      replayBtn.addEventListener('click',replay);
    })();
  </script>
</body>
</html>
